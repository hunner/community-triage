# Puppet PR Triage Notes 2014-11-05.md

Recording: 

### Attending

* **Adrien Thebo (adrienthebo)**
* **Andrew Parker (zaphod42)**
* **Will Hopper (whopper)**
* **Britt Gresham (demophoon)**
* **Felix Frank (ffrank)**
* **Henrik Lindberg (hlindberg)**
* **Michael Smith (mikaelsmith)**
* **Josh Cooper (josh)**
* **Hailee Kenney (hailee)**

### Summary

At the start of the triage Puppet had 56 open PRs Facter had 4 open PRs, and Hiera had 1 open PR.

### Note

All comments paraphrased...may not be exactly what was said.

## New

We decided to use the github issue tracking system instead of using separate notes. From now on there will be a "Notes from triage" in the PR. PRs that have been triaged (are in flight) are now labeled with "Triaged" at github.

## Held Over
### Puppet

[3238](https://github.com/puppetlabs/puppet/pull/3238) - [PUP-3547](https://tickets.puppetlabs.com/browse/PUP-3547) File Server Mounts Should Support Directory Environments
  - this adds the ability to have different mount points for every environment
  - 10/29 - ffrank asked contributor whether there was a workaround for pseudo-modules?
  - ferventcoder asked if this opens a possible security issue due to %e opening up possible elevation. zaphod42 mentions this doesn't open any issues that were not already there.
  - zaphod42 states we already have a way - you create a module with your environment files. ffrank mentioned this earlier as well
  - ferventcoder mentions possible big files and git, even though user is not restricted to using git for a repo
  - zaphod42 states that this could be done now with just putting your files in a data module. And modules is where we should be going with this.
  - ffrank mentions this could be done as a sort of enhancement for r10k (like symlinks to local directories posing as modules)
  - ferventcoder pinged adrienthebo on r10k capabilities (it does support svn)
  - **Action**: 10/29 - ffrank commented on the ticket and we are waiting to see what need the contributor has for this.
  - 11/05 - Discussions: Suggest using plugin sync (issue with plugin sync and environments being fixed in 3.7.4)? Problem is that file server has no notion of environment what so ever. Questionable if the suggested fix in the PR is better than other available workarounds.
  - **Action**: 11/05 - if security is an issue many more changes are required, and if security is not an issue then other suggested work arounds are just as good. ffrank to comment on PR.

## Held Over
### Facter

[778](https://github.com/puppetlabs/facter/pull/778) - [FACT-698](https://tickets.puppetlabs.com/browse/FACT-698) Add fips_enabled fact
  - Josh adding notes to this PR and related PUP-3114 PR at 3044
  - Uncertain of the value of the fact if we don't intend to merge PUP-3114
  - Pinged Nick F on PUP-3114 for addressing this in docs
  - 10/01 - still believe this is a documentation issue for explicit. If we fix the doc in Puppet, not sure if this is something to move forward on with facter.
  - 10/07 - NO REVIEW
  - 10/15 - ferventcoder pinged NickF/Joshcooper on the ticket about whether a decision has been made
  - 11/05 - (Joshcooper) problem with feature is the need to restart from scratch since all generated keys will be wrong and cause segfaults after switch to fips.
  - **Action** 11/05 - finch to comment on the PR about implications, what needs to be documented, what does not work etc.

### Hiera

[209](https://github.com/puppetlabs/hiera/pull/209) - (maint) use a more recent version of beaker
  - when ready to merge, we'll want to watch the tests knowing this just went in
  - we may want to prefer an even more recent version of beaker
  - **Action**: 10/01 - holding on this for now, will evaluate again later
  - 10/07 - NO REVIEW

### Puppet

[3202](https://github.com/puppetlabs/puppet/pull/3202) - [PUP-3479](https://tickets.puppetlabs.com/browse/PUP-3479) Update Windows ffi dependency to new ffi
  - 10/22 - ticket was logged, fixes made
  - **Action**: 10/22 - ferventcoder to merge
  - 10/29 - NO REVIEW, holding while we work out a couple of issues
  - **Action**: 11/05 - whopper to review and merge

[3219](https://github.com/puppetlabs/puppet/pull/3219) - [PUP-3481](https://tickets.puppetlabs.com/browse/PUP-3219) A more forgiving regexp for parse_selinux_context()
  - 10/22, change relaxes the rule for matching quite extensively - what are the rules for the format?
  - **Action**: 10/22 - kylog - ask if there is a specification.
  - 10/29 - NO REVIEW
  - 11/01 - Contributor responded
  - 11/5 - zaphod42, there is no actual specification, so relaxing the regexp is reasonable.
  - **Action** 11/05 - finch to merge

[3165](https://github.com/puppetlabs/puppet/pull/3165) - [PUP-1077](https://tickets.puppetlabs.com/browse/PUP-1077) Remove Nagios from core
  - daenney was curious where this was and if there was anything to do
  - kylog said we are about a week or two out on this - working on logistics
  - **Action**: 10/22 - holding while we work out logistics
  - 10/29 - NO REVIEW
  - **Action**: 11/05 - britt to merge - then work out any packaging issues.

[3124](https://github.com/puppetlabs/puppet/pull/3124) - [PUP-3346](https://tickets.puppetlabs.com/browse/PUP-3446) Don't allow insecure SSL connections w/curl
  - ffrank noted that the `-k` is there from the beginning of time when this provider was added
  - **Action**: 10/15 - kylog left a note on ticket asking if this would be an issue specifically with OS X as it appears this is what this addresses
  - 10/29 - NO REVIEW
  - 11/5 (josh) ok with merging since the change makes the config more secure by default. If it then does not work, it is a separate problem. (ffrank) Change is good for 4.0, you will get errors if you do not trust upstream package managers. We have poor test coverage.
  - **Action** - 11/05:  hailee to merge, add test if needed

[3107](https://github.com/puppetlabs/puppet/pull/3107) - [PUP-3319](https://tickets.puppetlabs.com/browse/PUP-3319) - Retry send report if connection to master fails
  - sets a limit of 4 tries, but adds a retries parameter
  - zaphod42: this may catch system exit as well. That can be fixed.
  - zaphod42: it would be good to have a test, so if report does fail
  - much discussion and looking at removed retryaction.rb.
  - we'd want to clean this up and bring it back in as retry_action.rb
  - add blocks that could be passed to retry_action.
  - **Action**: 10/01 - We are going to fix up retryaction and then reevaluate this PR.
  - 10/07 - NO REVEW - Holding on this until we have retryaction updated.
  - 10/29 - NO REVIEW
  - 11/05 - blocked on PUP-3379, retryaction still hasn't been added back

[3027](https://github.com/puppetlabs/puppet/pull/3027): [PUP-3232](https://tickets.puppetlabs.com/browse/PUP-3232) Prevent group duplication when group list created from multiple sources
  - Need JIRA ticket, and some sort of tests
  - As of 9/10, Kylo to notify contributor
  - Specs and ticket added, but specs failing
  - 10/01 - followup next meeting (skipped)
  - 10/07 - kylog to take this and fixup
  - 10/15 - kylog to look at this week
  - 10/29 - discussion on whether this is valid or would break other things if fixed. ferventcoder asked if you could have multiple groups with the same name. ffrank not sure if this is necessary.
  - **Action**: 10/29 - Waiting on more feedback
  - 11/05 - (ffrank) it is a provider issue. Everytime it runs it is out of sync. The provider should do this in a different way - each provider should get its group list from its specific source (may have other implications). Unclear relationship between user/group managing types and their providers discussed. Puppet reads the "effective" user/group entries, but manages them using specific services. (finch) just because two groups have the same name does not mean that they are the same thing. The problem is the same as for package managers where only one provider can be selected. (josh) can identities (sids) be used instead of names like in the windows provider?
  - ** Action**: 11/05 zaphod42 to close PR, needs more specification of what is actually needed to solve this a good way.

[2770](https://github.com/puppetlabs/puppet/pull/2770): [PUP-1537](https://tickets.puppetlabs.com/browse/PUP-1537) Allow version and held states of a package to specified as separate properties
  - This is a very big and sticky issue, and might be worth promoting into the platform team because of the wide ranging ramifications
  - Plan is to discuss how we promote issues like this, and respond to the contributor with our next steps forward
  - Pending contributor response, willing to wait on this since we're asking a lot of the contributor
  - Will need to talk with Adrien tomorrow and figure out how to hand this off.
  - Didn't have time to look at on 8/27 -- major PR that has breaking changes and could require work.  Would need to be targeted at Puppet 4 at the very least, but this one is tricky.  Will try to investigate at next PR meeting.
  - As of 9/3, punting this one a week, since it's a BIG change
  - As of 9/10, probably punting to post-PuppetConf - too big for now
  - **Action**: 10/01 - This needs a ticket number and should probably be one of the workshopped PRs kylog had mentioned in his email on triages. That way we could concentrate on this one. The commits would need fixed up to include ticket number
  - 10/07 - ferventcoder pinged contributor about failing specs
  - 11/05 - joshcooper pinged contributor about failing specs
  - **Action**: 11/05 - josh to close PR with note to resubmit when issues have been addressed. 

## Merged or Closed Prior to Triage
### Facter

### Puppet

[3145](https://github.com/puppetlabs/puppet/pull/3145): [PUP-3341](https://tickets.puppetlabs.com/browse/PUP-3341) - Puppet apply breaks when an ENC returns an environment
  - This is similar to 3144 (includes commits from 3144), so could come after
  - ffrank: This is a bit more invasive, could override what ENC would tell a node to do
  - joshcooper: https://projects.puppetlabs.com/issues/3910 is the behavior we added in 3.x
  - ffrank: Shouldn't puppet apply exclusively look local?
  - should apply option have option to override environments?
  - zaphod42: we've been using the general rule that if it is specified on command line, it should take precedence.
  - kylog: what if they disagree (both manifest and an ENC)?
  - zaphod42: command line versus config can be discerned, just not yet sure if it can be discerned at the right point
  - Holding on this for now while we evaluate more of the implications - Let's start a puppet-dev thread
  - 10/05 - https://groups.google.com/forum/#!msg/puppet-dev/l5CnnSvOpW0/3cl-kzaacJQJ (@ffrank to start thread)
  - 10/07 - Closed by ffrank to retarget to master
  - 10/07 - ffrank retargeting against master
  - 10/15 - discussion is still pending
  - 10/29 - ffrank mentioned it doesn't seem like we are coming to a decision.
  - **Action**: 10/29 - ffrank to give a suggested way forward and if no veto, we move forward with that
  - 11/5 PR closed.

[2649](https://github.com/puppetlabs/puppet/pull/2649): Add slot support for portage package provider.
  - Duplicates GH-2779, decision is to ping both contributors to see if they can coalesce their individual PRs into a single branch. Finch commenting this week.
  - GH-2779 hasn't seen updates, closing that one in favor of this one. There's some concern about possibly using `:` as a special value in package resource titles but we don't want to go down that route.
  - Pinged Adrien for a final call on this now that the specs are updated
  - Ethan to look at next week at some point
  - As of 9/3, Kylo asking contributor for a ticket, will revisit next week
  - As of 9/10, Kylo following up on following up
  - 9/30 - Kylo pinged contributor for ticket.
  - **Action**: 10/01 - waiting on contributor
  - 10/07 - NO REVIEW
  - 10/15 - NO REVIEW
  - 10/29 - ferventcoder pinged contributor with last warning about closing.
  - 11/05 - joshcooper closed
  
[3189](https://github.com/puppetlabs/puppet/pull/3189) - [PUP-3057](https://tickets.puppetlabs.com/browse/PUP-3057) ensure acceptance tests run on sol10
  - 10/22 - comment that commit should be updated
  - 10/22 - waiting for author, there are mentions of ubuntu that are surprising
  - 10/29 - ferventcoder posed a question.
  - **Action**: 10/29 - waiting on contributor
  - 11/04 - finch merged
  
[3247](https://github.com/puppetlabs/puppet/pull/3247) - [PUP-2310](https://tickets.puppetlabs.com/browse/PUP-2310) Treat a CRL as expired if it's past next_update
  - zaphod42: Can you trust the CRL? You [the agent] chose to trust the master
  - zaphod42: you have a chain of trust from the agent to the CA authority, you can't ask someone in that chain if your trust has been violated.
  - ffrank: since you don't normally contact the CA, the request is not appropriate.
  - zaphod42: the master gets updated since it maintains it.
  - ffrank: it would be really helpful if agents would keep up to date. Have created services that authenticate based on the CA.
  - hlindberg: what happens if this is not done? what would you otherwise do?
  - zaphod42: you would need to send it through another channel
  - hlindberg: how is this different than the first time?
  - zaphod42: it's not really, except the first time it's told what CA it should trust, which is also kind of a horrible thing really
  - hlindberg: does this make us any worse off b/c of doing the same thing it does at first? Who do we have that can evaluate this?
  - ferventcoder pinged joshcooper/adrienthebo about this
  - joshcooper: this only addresses part of the problem. It doesn't actually fix the master getting the crl update.
  - joshcooper: as long as it is using the CA to verify, then it is okay.
  - zaphod42: Essentially the sense I'm getting is my concern may not be valid?
  - ffrank: +1
  - joshcooper: there needs to be more intelligence on when the agent should redownload a new CRL. This would address when CRL expires in 5 years, it doesn't address a revoked and updated CRL.
  - zaphod42: maybe we just make getting CRL part of pluginsync
  - joshcooper: pluginsync is two things now, modules and external facts
  - zaphod42: might be critical to do CRL update first as a separate catalog application - agent should validate the CRL before it does anything else.
  - adrienthebo: it turns out certificate status is kind of hard. Splitting out could create additional issues
  - zaphod42: we had a PR for OCSP
  - adrienthebo: it rotted, it was a large change. OCSP could have better results. Something something fundamentally flawed. If you are MITMed, then ...
  - zaphod42: bringing the issue back to just this PR, it seems this is not going to address the case since it wouldn't expire for 5 years.
  - adrienthebo: we should set aside some time to address the CRL issue at hand. Should we take the time to design a correct solution in the foreseeable future? I would like to.
  - 10/29 - joshcooper/adrienthebo to talk about some possible options for moving forward this week.
  - 11/05 - joshcooper/adrienthebo to talk with server team about OCSP
